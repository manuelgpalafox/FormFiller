<!DOCTYPE HTML>
<html lang="es" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous">

    <script type="text/javascript">
        function uncheckOthers(checkbox) {
            var checkboxes = document.getElementsByName("selectedClient");
            for (var i = 0; i < checkboxes.length; i++) {
                if (checkboxes[i] !== checkbox) {
                    checkboxes[i].checked = false;
                }
            }

            var atLeastOneChecked = Array.from(checkboxes).some(checkbox => checkbox.checked);

            document.getElementById("editButton").disabled = !atLeastOneChecked;
            document.getElementById("deleteButton").disabled = !atLeastOneChecked;
        }
    </script>

    <title>Generador de solicitudes</title>
</head>

<body>
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container-fluid">
        <a class="navbar-brand" th:href="@{/clients/listPaged}">Generador de solicitudes</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent"
                aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse d-flex justify-content-between" id="navbarSupportedContent">
            <div class="d-flex">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item" sec:authorize="hasRole('ADMIN')">
                        <a class="nav-link active" aria-current="page" th:href="@{/users/registration}">Registrar
                            Usuario</a>
                    </li>
                    <li class="nav-item" sec:authorize="hasRole('ADMIN')">
                        <a class="nav-link active" aria-current="page" th:href="@{/users/list}">Mostrar Usuarios</a>
                    </li>
                </ul>
            </div>
            <div class="d-flex justify-content-end">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0 d-flex align-items-center">
                    <li class="nav-item">
                        <a class="nav-link active text-danger" aria-current="page" th:href="@{/logout}">Cerrar Sesi&oacute;n</a>
                    </li>
                </ul>
                <h6 class="nav-link d-flex align-items-center mb-0 text-white">Usuario: <span class="ms-1"
                                                                                              sec:authentication="principal.username"></span>
                </h6>
            </div>
        </div>
    </div>
</nav>
<br>

<div class="container">

    <h3>Lista de Clientes</h3>
    <hr>

    <div id="actions" style="display: flex;">
        <a th:href="@{/clients/showFormForAdd}"
           class="btn btn-primary btn-sm mb-3">
            Agregar Cliente
        </a>

        <button id="editButton" class="btn btn-primary btn-sm mb-3 ms-3" form="editOrDeleteClientForm" type="submit"
                th:name="action"
                th:value="edit" disabled>
            Editar Cliente
        </button>

        <button id="deleteButton" class="btn btn-primary btn-sm mb-3 ms-3" form="editOrDeleteClientForm" type="submit"
                th:name="action"
                th:value="delete" disabled>
            Eliminar Cliente
        </button>
    </div>

    <form id="editOrDeleteClientForm" action="#" th:action="@{/clients/showFormForEditOrDelete}" method="get">

        <table class="table table-bordered table-striped">
            <thead class="table-dark">
            <tr>

                <th>Seleccionar</th>
                <th><a th:href="@{'/clients/listPagedSorted?sortField=firstName&isSorted&sortOrder='+${reverseSortOrder}}">Nombre(s)</a></th>
                <th><a th:href="@{'/clients/listPagedSorted?sortField=lastName&isSorted&sortOrder='+${reverseSortOrder}}">Apellidos</a></th>
                <th>N&uacute;mero de tel&eacute;fono</th>
                <th><a th:href="@{'/clients/listPagedSorted?sortField=added&isSorted&sortOrder='+${reverseSortOrder}}">Fecha de registro</a></th>
                <th>Solicitudes</th>

            </tr>
            </thead>

            <tbody>
            <tr th:each="tempClient : ${clients}">
                <td style="text-align:center;">
                    <input type="checkbox" th:name="selectedClient" th:value="${tempClient.id}"
                           onclick="uncheckOthers(this)"/>
                </td>
                <td th:text="${tempClient.firstName+' '+tempClient.middleName}"></td>
                <td th:text="${tempClient.lastName+' '+tempClient.secondLastName}"></td>
                <td th:text="${tempClient.phoneNumber}"></td>
                <td th:text="${#dates.format(tempClient.added, 'dd/MM/yyyy')}"></td>
                <td >
                    <div>
                        <a th:href="@{/PDFCreation/showFormForCreatingPdf(clientId=${tempClient.id}, bankName='Banorte')}" class="btn">
                            <img th:src="@{/images/banortelogo.png}" alt="Banorte Logo" class="img-thumbnail">
                        </a>

                        <a th:href="@{/PDFCreation/showFormForCreatingPdf(clientId=${tempClient.id}, bankName='Bbva')}" class="btn">
                            <img th:src="@{/images/bbvalogo.png}" alt="BBVA Logo" class="img-thumbnail">
                        </a>

                        <a th:href="@{/PDFCreation/showFormForCreatingPdf(clientId=${tempClient.id}, bankName='Cibanco')}" class="btn">
                            <img th:src="@{/images/cibancologo.png}" alt="Cibanco Logo" class="img-thumbnail">
                        </a>

                        <a th:href="@{/PDFCreation/showFormForCreatingPdf(clientId=${tempClient.id}, bankName='Credinissan')}" class="btn">
                            <img th:src="@{/images/credinissanlogo.png}" alt="Credinissan Logo" class="img-thumbnail">
                        </a>

                        <a th:href="@{/PDFCreation/showFormForCreatingPdf(clientId=${tempClient.id}, bankName='Scotiabank')}" class="btn">
                            <img th:src="@{/images/scotiabanklogo.png}" alt="Scotiabank Logo" class="img-thumbnail">
                        </a>
                    </div>

                    <div>
                        <div class="btn" >
                            <img th:src="@{${tempClient.banorte} ? '/images/checked.png' : '/images/blank.png'}" alt="Status image" class="img-thumbnail">
                        </div>
                        <div class="btn" >
                            <img th:src="@{${tempClient.bbva} ? '/images/checked.png' : '/images/blank.png'}" alt="Status image" class="img-thumbnail">
                        </div>
                        <div class="btn" >
                            <img th:src="@{${tempClient.cibanco} ? '/images/checked.png' : '/images/blank.png'}" alt="Status image" class="img-thumbnail">
                        </div>
                        <div class="btn" >
                            <img th:src="@{${tempClient.credinissan} ? '/images/checked.png' : '/images/blank.png'}" alt="Status image" class="img-thumbnail">
                        </div>
                        <div class="btn" >
                            <img th:src="@{${tempClient.scotiabank} ? '/images/checked.png' : '/images/blank.png'}" alt="Status image" class="img-thumbnail">
                        </div>
                    </div>
                </td>
            </tr>
            </tbody>
        </table>

        <div id="sortedPaging" class="d-flex"  th:if="${param.isSorted}" >
            <p>Total de clientes: [[${totalElements}]]</p>
            <p class="ms-3">- P&aacute;gina: [[${currentPage}]] de [[${totalPages}]] -</p>

            <a class="ms-3" th:if="${page > 1}" th:href="@{'/clients/listPagedSorted?sortField='+${sortField}+'&isSorted&page=1&sortOrder='+${sortOrder}}">&lt;&lt; Primer p&aacute;gina</a>

            <a class="ms-3" th:if="${page > 1}" th:href="@{'/clients/listPagedSorted?sortField='+${sortField}+'&isSorted=true&page=' + ${page - 1} + '&sortOrder=' + ${sortOrder}}">&lt; P&aacute;gina anterior</a>

            <span class="ms-3" th:each="i: ${#numbers.sequence(1,totalPages)}">
                <a th:if="${i != page}" th:href="@{'/clients/listPagedSorted?sortField='+${sortField}+'&isSorted=true&page=' + ${i} + '&sortOrder=' + ${sortOrder}}">[[${i}]]</a>
                <span th:unless="${i != page}">[[${i}]]</span>
            </span>

            <a class="ms-3" th:if="${page < totalPages}" th:href="@{'/clients/listPagedSorted?sortField='+${sortField}+'&isSorted=true&page=' + ${page + 1} + '&sortOrder=' + ${sortOrder}}">P&aacute;gina siguiente &gt;</a>

            <a class="ms-3" th:if="${page < totalPages}" th:href="@{'/clients/listPagedSorted?sortField='+${sortField}+'&isSorted=true&page=' + ${totalPages} + '&sortOrder=' + ${sortOrder}}">&Uacute;ltima p&aacute;gina &gt;&gt;</a>

        </div>

        <div id="unsortedPaging" class="d-flex" th:unless="${param.isSorted}">
            <p>Total de clientes: [[${totalElements}]]</p>
            <p class="ms-3">- P&aacute;gina: [[${currentPage}]] de [[${totalPages}]] -</p>

            <a class="ms-3" th:if="${currentPage > 1}" th:href="@{'/clients/listPaged'}">&lt;&lt; Primer p&aacute;gina</a>

            <a class="ms-3" th:if="${currentPage > 1}" th:href="@{'/clients/listPaged/' + ${currentPage - 1}}">&lt; P&aacute;gina anterior</a>

            <span class="ms-3" th:each="i: ${#numbers.sequence(1,totalPages)}">
                <a th:if="${i != currentPage}" th:href="@{'/clients/listPaged/'+${i}}">[[${i}]]</a>
                <span th:unless="${i != currentPage}">[[${i}]]</span>
            </span>

            <a class="ms-3" th:if="${currentPage < totalPages}" th:href="@{'/clients/listPaged/' + ${currentPage + 1}}">P&aacute;gina siguiente &gt;</a>

            <a class="ms-3" th:if="${currentPage < totalPages}" th:href="@{'/clients/listPaged/' + ${totalPages}}">&Uacute;ltima p&aacute;gina &gt;&gt;</a>
        </div>
    </form>
</div>
</body>
</html>